# netology-4.0

Задание 1

Есть скрипт:


#!/bin/bash

a=1
b=2

c=a+b
d=$a+$b
e=$(($a+$b))

echo "Переменная c= $c"
echo "Переменная d= $d"
echo "Переменная e= $e"

Какие значения переменным c,d,e будут присвоены?
Почему?

#==============================

Ответ:

Переменная c= a+b
Переменная d= 1+2
Переменная e= 3

Переменная c – использует не значения переменных, а просто их имена «a» и «b».

Переменная d – тут применяется подстановка. Уже вместо имен переменных используются их значения. 
Однако сумма не высчитывается, т.к. мы не используем для вычисления суммы инструментов арифметики (типа let, exp и т.п.), да и по умолчанию значения наших переменных это не цифры, а строки.

Переменная e – получаем сумму, т.к. используем встроенную в bash функцию для выполнения арифметических операций – это двойные скобки.
Внутри ((...)) вычисляются арифметические выражения и возвращается их результат. Результат сложения «a» и «b» сохраняем в переменной «e».
Конструкция:
variable=$((выражение))

#========================

Задание 2

На нашем локальном сервере упал сервис и мы написали скрипт, который постоянно проверяет его доступность, 
записывая дату проверок до тех пор, пока сервис не станет доступным. 
В скрипте допущена ошибка, из-за которой выполнение не может завершиться, при этом место на Жёстком Диске постоянно уменьшается. 
Что необходимо сделать, чтобы его исправить:

while ((1==1)
do
curl https://localhost:4757
if (($? != 0))
then
date >> curl.log
fi
done

#=======================

Ответ:

В условии не хватает закрывающей скобки )  - в условии цикла while 

Можно добавить – паузу: sleep - для задания интервала проверки, чтобы файл curl.log не «рос» так быстро и проверки не делались так часто.

Нужно предусмотреть выход из цикла например через: else exit (если результат проверки будет неудачным)

Например,

#!/bin/bash

while ((1==1))

do

sleep 5
curl https://localhost:4757

if (($? != 0)); then
		date >> /tmp/curl.log
	else
	exit
fi

done

#============================
Задание 3 

Необходимо написать скрипт, который проверяет доступность трёх IP: 192.168.0.1, 173.194.222.113, 87.250.250.242 по 80 порту
и записывает результат в файл log. Проверять доступность необходимо пять раз для каждого узла.



 Ответ:

при составлении скрипта использовал цикл "for" внутри цикла "while", который будет прогонять "for" - 5 раз.


#!/bin/bash

IP="192.168.0.1 173.194.222.113 87.250.250.242"

mdate="$(date -u)"

x=0
while [ $x -lt 5 ]
do

for i in $IP; do nc -z $i 80 ; echo "$mdate - server $i - result $?" >>/tmp/ip_check.log; done

    x=$(($x+1))

done


Результат:

cat /tmp/ip_check.log 

Чт 24 июн 2021 16:00:31 UTC - server 192.168.0.1 - result 0
Чт 24 июн 2021 16:00:31 UTC - server 173.194.222.113 - result 0
Чт 24 июн 2021 16:00:31 UTC - server 87.250.250.242 - result 0
Чт 24 июн 2021 16:00:31 UTC - server 192.168.0.1 - result 0
Чт 24 июн 2021 16:00:31 UTC - server 173.194.222.113 - result 0
Чт 24 июн 2021 16:00:31 UTC - server 87.250.250.242 - result 0
Чт 24 июн 2021 16:00:31 UTC - server 192.168.0.1 - result 0
Чт 24 июн 2021 16:00:31 UTC - server 173.194.222.113 - result 0
Чт 24 июн 2021 16:00:31 UTC - server 87.250.250.242 - result 0
Чт 24 июн 2021 16:00:31 UTC - server 192.168.0.1 - result 0
Чт 24 июн 2021 16:00:31 UTC - server 173.194.222.113 - result 0
Чт 24 июн 2021 16:00:31 UTC - server 87.250.250.242 - result 0
Чт 24 июн 2021 16:00:31 UTC - server 192.168.0.1 - result 0
Чт 24 июн 2021 16:00:31 UTC - server 173.194.222.113 - result 0
Чт 24 июн 2021 16:00:31 UTC - server 87.250.250.242 - result 0

#============

Задание 4


Необходимо дописать скрипт из предыдущего задания так, чтобы он выполнялся до тех пор, пока один из узлов не окажется недоступным. 
Если любой из узлов недоступен - IP этого узла пишется в файл error, скрипт прерывается


Ответ: 
Всё тоже, что и в предыдущем скрипте, только внутрь цикла "for" ввел оператор условия "if"
Для примера, добавил четвёртый адрес, для "получения" ошибки в протоколе, т.е. когда результат проверки будет не равен "0",
в этом случае пишем в протокол "IP ERROR" и через "break 2" завершаем внений цикл "while", скрипт завершает свою работу.


Скрипт:

#!/bin/bash

IP="192.168.0.1 173.194.222.113 87.250.250.242 10.0.0.1"

mdate="$(date -u)"

x=0
while [ $x -lt 5 ]
do

for i in $IP; do nc -z $i 80 >/dev/null;
       
	res=$?
	if [ $res -eq 0 ]
	then
		echo "$mdate - server $i - result $res" >> /tmp/ip_check.log
	else	
	        echo "$mdate - server $i ERROR status=$res" >>/tmp/ip_check.log
		break 2
	fi
    done

    x=$(($x+1))

done


Результат (отрывок из файла протокола)

cat  /tmp/ip_check.log

Чт 24 июн 2021 17:22:12 UTC - server 192.168.0.1 - result 0
Чт 24 июн 2021 17:22:12 UTC - server 173.194.222.113 - result 0
Чт 24 июн 2021 17:22:12 UTC - server 87.250.250.242 - result 0
Чт 24 июн 2021 17:22:12 UTC - server 10.0.0.1 ERROR status=1




